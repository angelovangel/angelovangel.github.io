---
title: "Using R for enzyme kinetics analysis"
author: "Angel Angelov"
date: 2017-06-29
output:
  html_notebook: default
  html_document: default
  pdf_document: default
---

## The data

Prepare your data so that it has two columns: substrate concentration and velocity. Load it in R, taking care about formatting and the german locale. Note I also use the 'propagate' package later, so I am loading it now 
Here is some example data:

```{r, message=FALSE}
library(tidyverse)
library(propagate)
library(broom)

df <- tibble(S = c(0,1,2,5,8,12,30,50), 
           v = c(0,11.1,25.4,44.8,54.5,58.2,72.0,60.1))
df
```

## A simple plot

Just to see how the data looks like:

```{r, echo=TRUE, fig.height=3, fig.width=5}
ggplot(df) + 
  geom_point(aes(x=S, y = v)) + 
  theme_bw() + 
  xlab("Substrate (mM)") + ylab("Velocity (nmol/s)")
```

## Michaelis-Menten model
The formula is "velocity = Vmax * S / (Km + S)". We store it in 'MMformula'. We then use 'nls' for building the model, providing some initial values for the parameters Vmax and Km. These initial values we can estimate visually from the plot, they don't have to be very good as they are just the starting point for the 'nls' function. What 'nls' is doing is to find the least-squares estimates of the parameters of the non-linear model.
```{r}
MMformula <-formula(v~Vmax*S/(Km+S))
MMmodel <- nls(MMformula, df, start = list(Vmax = 60, Km = 5))
```
Take a look at the fitted model:
```{r}
summary(MMmodel)
```
## Plotting
In order to plot the fitted model values, we just run 'predict()' on the model we just generated. Note, I use 'predictNLS' here from the 'propagate' package, because it can give also confidence intervals for the predicted values. In base 'R' this is not implemented (and will probably never be for 'nls').
```{r, message = FALSE}
pred <- predictNLS(MMmodel, newdata = data.frame(S = df$S))
pred$summary

```
Add the predicted values to the dataframe and plot
```{r}
df2 <- cbind(df, pred$summary)
ggplot(df2) + geom_point(aes(x = S, y = v), alpha = 0.6) + 
  geom_line(aes(x=S, y = Prop.Mean.1), color = "red") + 
  geom_line(aes(x=S, y=`Prop.97.5%`), linetype = 3) + 
  geom_line(aes(x=S, y=`Prop.2.5%`), linetype = 3) +
  xlab("Substrate (mM)") + 
  ylab("Velocity (nmol/s)")+
  theme_bw()
```

Cheers!
Angel
